/*
作者：薛翼舟
以下为检查禁手的函数
*/


#include "checkban.h"
#include<stdio.h>
#include "variable.h"
#include <time.h>
#define SIZE 15

int CheckBoard[SIZE][SIZE];

int CheckBan(int depth,int i,int j){
    time_t start = clock();
    if(depth==0){
        return 0;
    }
    int out1=0,out2=0,out3=0;
    if(i<0 ||i>=SIZE || j<0|| j>=SIZE)
        return 0;
    CheckBoard[i][j]=1;
    out1 = CheckLong(depth,i,j)||CheckMulti4(depth,i,j)||CheckMulti3(depth,i,j);
    CheckBoard[i][j]=0;
    time_t end = clock();
    time_checkban += ((double)end-start)/CLOCKS_PER_SEC;
    return out1;
}


//检查长连禁手
int CheckLong(int depth,int i,int j){
    int out=0;
    //对四个方向上的长连禁手分别检验
    if((CheckLongRow(depth,i,j)!=0) ||(CheckLongCol(depth,i,j)!=0) ||(CheckLongAtoD(depth,i,j)!=0) ||(CheckLongBtoC(depth,i,j)!=0)){
        out = 1;
    }
    return out;;
}

//检查行上的长连禁手
int CheckLongRow(int depth,int i,int j){
    int out=0;
    int ban;
    int k,r;

    //设置开始，结束的搜索范围，不能越界
    int start = j-5>0? j-5: 0;
    int end = j+5<14? j+5: 14;

    //如果有不少于6个的连子，则是长连
    for(k=start; k<=j; k++){
        ban=1;
        for(r=0;r<6;r++){
            if(k+r>end || (CheckBoard[i][k+r]!=1)){
                ban=0;
                break;
            }
        }
        if(ban==1){
                out = ban;
                break;
        }
    }
    return out;
}


//检查列上的长连禁手
int CheckLongCol(int depth,int i,int j){
    int out=0;
    int ban;
    int k,r;
    int start = i-5>0? i-5: 0;
    int end = i+5<14? i+5: 14;
    for(k=start; k<=i; k++){
        ban=1;
        for(r=0;r<6;r++){
            if(k+r>end || (CheckBoard[k+r][j]!=1)){
                ban=0;
                break;
            }
        }
        if(ban==1){
                out = ban;
                break;
        }
    }
    return out;
}

//检查左斜的长连禁手
int CheckLongAtoD(int depth,int i,int j){
    int ban;
    int out = 0;
    int k;

    for(k = -5; k <= 0; k++){
        ban=1;
        int r;
        int start_i = i + k;
        int start_j = j + k;

        
        if(start_i < 0 || start_j < 0)
            continue;

       
        if(start_i + 5 >= SIZE|| start_j + 5 >= SIZE)
            continue;

    
        for(r = 0; r < 6; r++){
            if(CheckBoard[start_i + r][start_j + r] != 1){
                ban=0;
                break;
            }
        }
        if(ban == 1){
            out = 1;
            break;
        }
    }
    return out;
}

//检查右斜的长连禁手
int CheckLongBtoC(int depth,int i,int j){
    int ban;
    int out = 0;
    int k;

    for(k = -5; k <= 0; k++){
        ban=1;
        int r;
        int start_i = i - k;
        int start_j = j + k;

        
        if(start_i >= SIZE || start_j < 0)
            continue;

       
        if(start_i - 5 < 0|| start_j + 5 >= SIZE)
            continue;

    
        for(r = 0; r < 6; r++){
            if(CheckBoard[start_i - r][start_j + r] != 1){
                ban=0;
                break;
            }
        }
        if(ban == 1){
            out = 1;
            break;
        }
    }
    return out;
}

//检查双四的禁手
int CheckMulti4(int depth,int i, int j){
    int out=0;
    int count=0;

    //分别检查四个方向上的四的数量，如果总和超过两个，则是双四禁手
    count = Check4Row(depth,i,j)+Check4Col(depth,i,j)+Check4AtoD(depth,i,j)+Check4BtoC(depth,i,j);
    if(count>=2){
        out = 1;
    }
    return out;
}

//检查横向上的四
int Check4Row(int depth,int i,int j){
    int count=0;
    int out=0;
    int check_available;

    int k,r,q;
    int start = j - 4 > 0 ? j - 4 : 0;
    int end = j + 4 < 14 ? j + 4 : 14;

    //首先检查四连的活四和冲四，之后的判断同理
    if(Check4StrRow(depth,i,j)==1){
        return 1;
    }

    for (k = start; k <= j; k++) {
        count = 0;
        check_available = 0;
        for(r = 0 ; r < 5; r++){
            if(CheckBoard[i][k+r] == 1){
                count++;
            }
            if (k + r > end || CheckBoard[i][k + r] == 2) {
                count = 0;
                break;
            }
        }
        if(count == 4){
                for(q = 0; q < 4; q++){
                    if(CheckBoard[i][k+q]==0 && CheckBan(depth-1,i,k+q)==0){
                        check_available = 1;
                        break;
                    }
                }
        }
        if(count==4 && check_available==1){
            out ++;
        }
    }
    return out;
}

int Check4StrRow(int depth,int i,int j){//??????????????, ????а???(i,j)???????????
    int out = 0;
    int k, r;

    int start = j - 3 > 0 ? j - 3 : 0;
    int end = j + 3 < 14 ? j + 3 : 14;

    for (k = start; k <= j; k++) {
        int check = 1;
        for (r = 0; r < 4; r++) {
            if (k + r > end || CheckBoard[i][k + r] != 1) {
                check = 0;
                break;
            }
        }
        if (check) {//????????????????, ?????????????????????????Ч?????????
            if(k-1>=0 && CheckBoard[i][k-1]==0 && CheckBan(depth-1,i,k-1)==0){//???????п???, ??λ?????????
                out=1;
                break;
            }
            if(k+4<=14 && CheckBoard[i][k+4]==0 && CheckBan(depth-1,i,k+4)==0){
                out=1;
                break;
            }
        }
    }
    return out;
}

int Check4Col(int depth,int i,int j){//?????????????????
    int count=0;
    int out=0;
    int check_available;

    int k,r,q;
    int start = i - 4 > 0 ? i - 4 : 0;//?????λ????????0
    int end = i + 4 < 14 ? i + 4 : 14;//??????λ????????14

    if(Check4StrCol(depth,i,j)==1){//???????????Ч????????, ??????1
        return 1;
    }

    for (k = start; k <= i; k++) {//?????????????"?п?"????????
        count = 0;
        check_available = 0;
        for(r = 0 ; r < 5; r++){
            if(CheckBoard[k+r][j] == 1){
                count++;
            }
            if (k + r > end || CheckBoard[k + r][j] == 2) {//??????????????????????, ??????????
                count = 0;
                break;
            }
        }
        if(count == 4){//??????????λ????????????, ???????п???
                for(q = 0; q < 5; q++){
                    if(CheckBoard[k+q][j]==0 && CheckBan(depth-1,k+q,j)==0){//????п???, ?????????λ????????
                        check_available = 1;
                        break;
                    }
                }
        }
        if(count==4 && check_available==1){//????????λ???????????????????????????Ч?????
            out ++;
        }
    }
    return out;
}

int Check4StrCol(int depth,int i,int j){//??????????????, ????а???(i,j)????????????
    int out = 0;
    int k, r;

    int start = i - 3 > 0 ? i - 3 : 0;
    int end = i + 3 < 14 ? i + 3 : 14;

    for (k = start; k <= i; k++) {
        int check = 1;
        for (r = 0; r < 4; r++) {
            if (k + r > end || CheckBoard[k + r][j] != 1) {
                check = 0;
                break;
            }
        }
        if (check) {//????????????????, ?????????????????????????Ч?????????
            if(k-1>=0 && CheckBoard[k-1][j]==0 && CheckBan(depth-1,k-1,j)==0){//???????п???, ??λ?????????
                out = 1;
                break;
            }
            if(k+4<=14 && CheckBoard[k+4][j]==0 && CheckBan(depth-1,k+4,j)==0){
                out = 1;
                break;
            }
        }
    }
    return out;
}

int Check4AtoD(int depth,int i,int j){//???б????????????
    int count=0;
    int out=0;
    int check_available;

    int k,r,q;
    int start_i = i - 4 > 0 ? i - 4 : 0;//?????λ????????0
    int start_j = j - 4 > 0 ? j - 4 : 0;
    int end_i = i + 4 < 14 ? i + 4 : 14;//??????λ????????14
    int end_j = j + 4 < 14 ? j + 4 : 14;

    if(Check4StrAtoD(depth,i,j)==1){//???????????Ч????????, ??????1
        return 1;
    }

    for (k = -4; k <= 0; k++) {//???б????????"?п?"????????
        if(i+k<0 || j+k<0)
            continue;//????????????С??0

        count = 0;
        check_available = 0;
        for(r = 0 ; r < 5; r++){
            if(CheckBoard[i+k+r][j+k+r] == 1){
                count++;
            }
            if (i + k + r > end_i || j + k + r > end_j || CheckBoard[i + k + r][j + k + r] == 2) {//??????????????????????, ??????????
                count = 0;
                break;
            }
        }
        if(count == 4){//??????????λ????????????, ???????п???
                for(q = 0; q < 5; q++){
                    if(CheckBoard[i+k+q][j+k+q]==0 && CheckBan(depth-1,i+k+q,j+k+q)==0){//????п???, ?????????λ????????
                        check_available = 1;
                        break;
                    }
                }
        }
        if(count==4 && check_available==1){//????????λ?????????????????????λ????Ч?????
            out ++;
        }
    }
    return out;
}

int Check4StrAtoD(int depth,int i,int j){//??????????????, ????а???(i,j)??б????????
    int out = 0;
    int k, r;

    int start_i = i - 3 > 0 ? i - 3 : 0;
    int start_j = j - 3 > 0 ? j - 3 : 0;
    int end_i = i + 3 < 14 ? i + 3 : 14;
    int end_j = j + 3 < 14 ? j + 3 : 14;

    for (k = -3; k <= 0; k++) {
        int check = 1;
        if(i+k<0 || j+k<0)
            continue;//????????С???0, ??????????????

        for (r = 0; r < 4; r++) {
            if (i + k + r > end_i || j + k + r > end_j || CheckBoard[i + k + r][j + k + r] != 1) {
                check = 0;
                break;
            }
        }
        if (check) {//????????????????, ?????????????????????????Ч?????????
            if(i+k-1>=0 && j+k-1>=0 && CheckBoard[i+k-1][j+k-1]==0 && CheckBan(depth-1,i+k-1,j+k-1)==0){//???????п???, ??λ?????????
                out = 1;
                break;
            }
            if(i+k+4<=14 && j+k+4<=14 && CheckBoard[i+k+4][j+k+4]==0 && CheckBan(depth-1,i+k+4,j+k+4)==0){
                out = 1;
                break;
            }
        }
    }
    return out;
}

int Check4BtoC(int depth,int i,int j){
    int count=0;
    int out=0;
    int check_available;

    int k,r,q;
    int start_i = i + 4 < 14 ? i + 4 : 14;//?????λ????????14
    int start_j = j - 4 > 0 ? j - 4 : 0;
    int end_i = i - 4 > 0 ? i - 4 : 0;//??????λ????????0
    int end_j = j + 4 < 14 ? j + 4 : 14;

    if(Check4StrBtoC(depth,i,j)==1){//???????????Ч????????, ??????1
        return 1;
    }

    for (k = -4; k <= 0; k++) {//???б????????"?п?"????????
        if(i-k>=SIZE || j+k<0)
            continue;//???????????????

        count = 0;
        check_available = 0;
        for(r = 0 ; r < 5; r++){
            if(CheckBoard[i-k-r][j+k+r] == 1){
                count++;
            }
            if (i - k - r < end_i || j + k + r > end_j || CheckBoard[i - k - r][j + k + r] == 2) {//??????????????????????, ??????????
                count = 0;
                break;
            }
        }
        if(count == 4){//??????????λ????????????, ???????п???
                for(q = 0; q < 5; q++){
                    if(CheckBoard[i-k-q][j+k+q]==0 && CheckBan(depth-1,i-k-q,j+k+q)==0){//????п???, ?????????λ????????
                        check_available = 1;
                        break;
                    }
                }
        }
        if(count==4 && check_available==1){//????????λ???????????????????????
            out ++;
        }
    }
    return out;
}

int Check4StrBtoC(int depth,int i,int j){//??????????????, ????а???(i,j)??б????????
    int out = 0;
    int k, r;

    int start_i = i + 3 < 14 ? i + 3 : 14;
    int start_j = j - 3 > 0 ? j - 3 : 0;
    int end_i = i - 3 > 0 ? i - 3 : 0;
    int end_j = j + 3 < 14 ? j + 3 : 14;

    for (k = -3; k <= 0; k++) {
        int check = 1;
        if(i-k>=SIZE || j+k<0)
            continue;//????????????, ??????????????

        for (r = 0; r < 4; r++) {
            if (i - k - r < end_i || j + k + r > end_j || CheckBoard[i - k - r][j + k + r] != 1) {
                check = 0;
                break;
            }
        }
        if (check) {//????????????????, ?????????????????????????Ч?????????
            if(i-k+1<=14 && j+k-1>=0 && CheckBoard[i-k+1][j+k-1]==0 && CheckBan(depth-1,i-k+1,j+k-1)==0){//???????п???, ??λ?????????
                out = 1;
                break;
            }
            if(i-k-4>=0 && j+k+4<=14 && CheckBoard[i-k-4][j+k+4]==0 && CheckBan(depth-1,i-k-4,j+k+4)==0){
                out = 1;
                break;
            }
        }
    }
    return out;
}

int CheckMulti3(int depth,int i,int j){
    int out=0;
    int count=0;
    count = Check3Row(depth,i,j)+Check3Col(depth,i,j)+Check3AtoD(depth,i,j)+Check3BtoC(depth,i,j);
    if(count>=2){
        out= 1;
    }
    return out;
}

int Check3Row(int depth,int i,int j){
    int count=0;
    int out=0;
    int check_available;

    int k,r,q;
    int start = j - 3 > 0 ? j - 3 : 0;//?????λ????????0
    int end = j + 3 < 14 ? j + 3 : 14;//??????λ????????14

    if(Check3StrRow(depth,i,j)==1){//???????????Ч????????, ??????1
        return 1;
    }

    for (k = start; k <= j; k++) {//?????????????"?п?"????????, ????????п????????, ???????????????????
        count = 0;
        check_available = 0;
        for(r = 0 ; r < 4; r++){//??????λ????????????????
            if(CheckBoard[i][k+r] == 1){
                count++;
            }
            if (k + r > end || CheckBoard[i][k + r] == 2) {//??????????????????????, ??????????
                count = 0;
                break;
            }
        }
        if(count == 3){//??????????λ??????????????, ?????????????????
                for(q = 0; q < 4; q++){
                    if(CheckBoard[i][k+q]==0 && CheckBan(depth-1,i,k+q)==0){//????п???, ?????????λ????????
                        check_available = 1;
                        break;
                    }//????????ж??, ??????????????γ????????
                }
        }
        if(check_available==1){//????????λ????????????????????????????Ч???λ, ???????λ?????1
            CheckBoard[i][k+q]=1;
            if(k-1>=0 && CheckBoard[i][k-1]==0 && CheckBan(depth-1,i,k-1)==0 && k+4<=14 && CheckBoard[i][k+4]==0 && CheckBan(depth-1,i,k+4)==0){//??????????????γ????????????????
                out++;//????????γ?????????????????
            }
            CheckBoard[i][k+q]=0;
        }
    }
    return out;
}

int Check3StrRow(int depth,int i,int j){//?????????????y???????
    int out = 0;
    int k, r;

    int start = j - 2 > 0 ? j - 2 : 0;
    int end = j + 2 < 14 ? j + 2 : 14;

    for (k = start; k <= j; k++) {
        int check = 1;
        for (r = 0; r < 3; r++) {
            if (k + r > end || CheckBoard[i][k + r] != 1) {
                check = 0;
                break;
            }
        }
        if (check) {//????????????????, ???????????????????????????????
            if(k-1>=0 && CheckBoard[i][k-1]==0 && CheckBan(depth-1,i,k-1)==0){//?????????????????
                CheckBoard[i][k-1]=1;
                if(k-2>=0 && CheckBoard[i][k-2]==0 && CheckBan(depth-1,i,k-2)==0){//??????????????????????Ч
                    if(k+3<=14 && CheckBoard[i][k+3]==0 && CheckBan(depth-1,i,k+3)==0){
                        out = 1;
                        break;
                    }
                }
                CheckBoard[i][k-1]=0;
            }
            if(k+3<=14 && CheckBoard[i][k+3]==0 && CheckBan(depth-1,i,k+3)==0){//??????????????????
                CheckBoard[i][k+3]=1;
                if(k+4<=14 && CheckBoard[i][k+4]==0 && CheckBan(depth-1,i,k+4)==0){//???????????????????????Ч
                    if(k-1>=0 && CheckBoard[i][k-1]==0 && CheckBan(depth-1,i,k-1)==0){
                        out = 1;
                        CheckBoard[i][k+3]=0;
                        break;
                    }
                }
                CheckBoard[i][k+3]=0;
            }
        }
    }
    return out;
}

int Check3Col(int depth,int i,int j){
    int count=0;
    int out=0;
    int check_available;

    int k,r,q;
    int start = i - 3 > 0 ? i - 3 : 0;//?????λ????????0
    int end = i + 3 < 14 ? i + 3 : 14;//??????λ????????14

    if(Check3StrCol(depth,i,j)==1){//???????????Ч????????, ??????1
        return 1;
    }

    for (k = start; k <= i; k++) {//?????????????"?п?"????????
        count = 0;
        check_available = 0;
        for(r = 0 ; r < 4; r++){
            if(CheckBoard[k+r][j] == 1){
                count++;
            }
            if (k + r > end || CheckBoard[k + r][j] == 2) {//??????????????????????, ??????????
                count = 0;
                break;
            }
        }
        if(count == 3){//??????????λ??????????????, ???????п???
                for(q = 0; q < 4; q++){
                    if(CheckBoard[k+q][j]==0 && CheckBan(depth-1,k+q,j)==0){//????п???, ?????????λ????????
                        check_available = 1;
                        break;
                    }
                }
        }
        if(check_available==1){//????????λ????????????????????????????Ч???λ
            CheckBoard[k+q][j]=1;
            if(k-1>=0 && CheckBoard[k-1][j]==0 && CheckBan(depth-1,k-1,j)==0 && k+4<=14 && CheckBoard[k+4][j]==0 && CheckBan(depth-1,k+4,j)==0){//??????????????γ????????????????
                out++;
            }
            CheckBoard[k+q][j]=0;
        }
    }
    return out;
}

int Check3StrCol(int depth,int i,int j){//?????????????y???????
    int out = 0;
    int k, r;

    int start = i - 2 > 0 ? i - 2 : 0;
    int end = i + 2 < 14 ? i + 2 : 14;

    for (k = start; k <= i; k++) {
        int check = 1;
        for (r = 0; r < 3; r++) {
            if (k + r > end || CheckBoard[k + r][j] != 1) {
                check = 0;
                break;
            }
        }
        if (check) {//????????????????, ???????????????????????????????
            if(k-1>=0 && CheckBoard[k-1][j]==0 && CheckBan(depth-1,k-1,j)==0){//?????????????????
                CheckBoard[k-1][j]=1;
                if(k-2>=0 && CheckBoard[k-2][j]==0 && CheckBan(depth-1,k-2,j)==0){//??????????????????????Ч
                    if(k+3<=14 && CheckBoard[k+3][j]==0 && CheckBan(depth-1,k+3,j)==0){
                        out = 1;
                        break;
                    }
                }
                CheckBoard[k-1][j]=0;
            }
            if(k+3<=14 && CheckBoard[k+3][j]==0 && CheckBan(depth-1,k+3,j)==0){//??????????????????
                CheckBoard[k+3][j]=1;
                if(k+4<=14 && CheckBoard[k+4][j]==0 && CheckBan(depth-1,k+4,j)==0){//???????????????????????Ч
                    if(k-1>=0 && CheckBoard[k-1][j]==0 && CheckBan(depth-1,k-1,j)==0){
                        out = 1;
                        break;
                    }
                }
                CheckBoard[k+3][j]=0;
            }
        }
    }
    return out;
}

int Check3AtoD(int depth,int i,int j){
    int count=0;
    int out=0;
    int check_available;

    int k,r,q;
    int start_i = i - 3 > 0 ? i - 3 : 0;//?????λ????????0
    int start_j = j - 3 > 0 ? j - 3 : 0;
    int end_i = i + 3 < 14 ? i + 3 : 14;//??????λ????????14
    int end_j = j + 3 < 14 ? j + 3 : 14;

    if(Check3StrAtoD(depth,i,j)==1){//???????????Ч????????, ??????1
        return 1;
    }

    for (k = -3; k <= 0; k++) {//???б????????"?п?"????????
        if(i+k<0 || j+k<0)
            continue;//???????????????

        count = 0;
        check_available = 0;
        for(r = 0 ; r < 4; r++){
            if(CheckBoard[i+k+r][j+k+r] == 1){
                count++;
            }
            if (i + k + r > end_i || j + k + r > end_j || CheckBoard[i + k + r][j + k + r] == 2) {//??????????????????????, ??????????
                count = 0;
                break;
            }
        }
        if(count == 3){//??????????λ??????????????, ???????п???
                for(q = 0; q < 4; q++){
                    if(CheckBoard[i+k+q][j+k+q]==0 && CheckBan(depth-1,i+k+q,j+k+q)==0){//????п???, ?????????λ????????
                        check_available = 1;
                        break;
                    }
                }
        }
        if(check_available==1){//????????λ????????????????????????????Ч??
            CheckBoard[i+k+q][j+k+q]=1;
            if((i+k-1>=0 && j+k-1>=0) && CheckBoard[i+k-1][j+k-1]==0 && CheckBan(depth-1,i+k-1,j+k-1)==0 && (i+k+4<=14 && j+k+4<=14) && 
            CheckBoard[i+k+4][j+k+4]==0 && CheckBan(depth-1,i+k+4,j+k+4)==0){//??????????????γ????????????????
                out++;
            }
            CheckBoard[i+k+q][j+k+q]=0;
        }
    }   
    return out;
}

int Check3StrAtoD(int depth,int i,int j){//?????????????y???????
    int out = 0;
    int k, r;

    int start_i = i - 2 > 0 ? i - 2 : 0;
    int start_j = j - 2 > 0 ? j - 2 : 0;
    int end_i = i + 2 < 14 ? i + 2 : 14;
    int end_j = j + 2 < 14 ? j + 2 : 14;

    for (k = -2; k <= 0; k++) {
        int check = 1;
        if(i+k<0 || j+k<0)
            continue;//????????????, ??????????????

        for (r = 0; r < 3; r++) {
            if (i + k + r > end_i || j + k + r > end_j || CheckBoard[i + k + r][j + k + r] != 1) {
                check = 0;
                break;
            }
        }
        if (check) {//????????????????, ???????????????????????????????
            if(i+k-1>=0 && j+k-1>=0 && CheckBoard[i+k-1][j+k-1]==0 && CheckBan(depth-1,i+k-1,j+k-1)==0){//???????п???, ??λ?????????
                CheckBoard[i+k-1][j+k-1]=1;
                if(i+k-2>=0 && j+k-2>=0 && CheckBoard[i+k-2][j+k-2]==0 && CheckBan(depth-1,i+k-2,j+k-2)==0){//???????п???, ??λ?????????
                    if(i+k+3<=14 && j+k+3<=14 && CheckBoard[i+k+3][j+k+3]==0 && CheckBan(depth-1,i+k+3,j+k+3)==0){
                        out = 1;
                        break;
                    }
                }
                CheckBoard[i+k-1][j+k-1]=0;
            }
            if(i+k+3<=14 && j+k+3<=14 && CheckBoard[i+k+3][j+k+3]==0 && CheckBan(depth-1,i+k+3,j+k+3)==0){//???????п???, ??λ?????????
                CheckBoard[i+k+3][j+k+3]=1;
                if(i+k+4<=14 && j+k+4<=14 && CheckBoard[i+k+4][j+k+4]==0 && CheckBan(depth-1,i+k+4,j+k+4)==0){//???????п???, ??λ?????????
                    if(i+k-1>=0 && j+k-1>=0 && CheckBoard[i+k-1][j+k-1]==0 && CheckBan(depth-1,i+k-1,j+k-1)==0){
                        out = 1;
                        break;
                    }
                }
                CheckBoard[i+k+3][j+k+3]=0;
            }
        }
    }
    return out;
}

int Check3BtoC(int depth,int i,int j){
    int count=0;
    int out=0;
    int check_available;

    int k,r,q;
    int start_i = i + 3 < 14 ? i + 3 : 14;//?????λ????????14
    int start_j = j - 3 > 0 ? j - 3 : 0;
    int end_i = i - 3 > 0 ? i - 3 : 0;//??????λ????????0
    int end_j = j + 3 < 14 ? j + 3 : 14;

    if(Check3StrBtoC(depth,i,j)==1){//???????????Ч????????, ??????1
        return 1;
    }

    for (k = -3; k <= 0; k++) {//???б????????"?п?"????????
        if(i-k>=SIZE || j+k<0)
            continue;//???????????????

        count = 0;
        check_available = 0;
        for(r = 0 ; r < 4; r++){
            if(CheckBoard[i-k-r][j+k+r] == 1){
                count++;
            }
            if (i - k - r < end_i || j + k + r > end_j || CheckBoard[i - k - r][j + k + r] == 2) {//??????????????????????, ??????????
                count = 0;
                break;
            }
        }
        if(count == 3){//??????????λ??????????????, ???????п???
                for(q = 0; q < 4; q++){
                    if(CheckBoard[i-k-q][j+k+q]==0 && CheckBan(depth-1,i-k-q,j+k+q)==0){//????п???, ?????????λ????????
                        check_available = 1;
                        break;
                    }
                }
        }
        if(check_available==1){
            CheckBoard[i-k-q][j+k+q]=1;
            if((i-k+1<=14 && j+k-1>=0) && CheckBoard[i-k+1][j+k-1]==0 && CheckBan(depth-1,i-k+1,j+k-1)==0 && (i-k-4>=0 && j+k+4<=14) && 
            CheckBoard[i-k-4][j+k+4]==0 && CheckBan(depth-1,i-k-4,j+k+4)==0){//??????????????γ????????????????
                out++;
            }
            CheckBoard[i-k-q][j+k+q]=0;
        }
    }
    return out;
}

int Check3StrBtoC(int depth,int i,int j){//?????????????y???????
    int out = 0;
    int k, r;

    int start_i = i + 2 < 14 ? i + 2 : 14;
    int start_j = j - 2 > 0 ? j - 2 : 0;
    int end_i = i - 2 > 0 ? i - 2 : 0;
    int end_j = j + 2 < 14 ? j + 2 : 14;

    for (k = -2; k <= 0; k++) {
        int check = 1;
        if(i-k>=SIZE || j+k<0)
            continue;//????????????, ??????????????

        for (r = 0; r < 3; r++) {
            if (i - k - r < end_i || j + k + r > end_j || CheckBoard[i - k - r][j + k + r] != 1) {
                check = 0;
                break;
            }
        }
        if (check) {//????????????????, ???????????????????????????????
            if(i-k+1<=14 && j+k-1>=0 && CheckBoard[i-k+1][j+k-1]==0 && CheckBan(depth-1,i-k+1,j+k-1)==0){//???????п???, ??λ?????????
                CheckBoard[i-k+1][j+k-1]=1;
                if(i-k+2<=14 && j+k-2>=0 && CheckBoard[i-k+2][j+k-2]==0 && CheckBan(depth-1,i-k+2,j+k-2)==0){//???????п???, ??λ?????????
                    if(i-k-3>=0 && j+k+3<=14 && CheckBoard[i-k-3][j+k+3]==0 && CheckBan(depth-1,i-k-3,j+k+3)==0){
                        out = 1;
                        break;
                    }
                }
                CheckBoard[i-k+1][j+k-1]=0;
            }
            if(i-k-3>=0 && j+k+3<=14 && CheckBoard[i-k-3][j+k+3]==0 && CheckBan(depth-1,i-k-3,j+k+3)==0){//???????п???, ??λ?????????
                CheckBoard[i-k-3][j+k+3]=1;
                if(i-k-4>=0 && j+k+4<=14 && CheckBoard[i-k-4][j+k+4]==0 && CheckBan(depth-1,i-k-4,j+k+4)==0){//???????п???, ??λ?????????
                    if(i-k+1<=14 && j+k-1>=0 && CheckBoard[i-k+1][j+k-1]==0 && CheckBan(depth-1,i-k+1,j+k-1)==0){
                        out = 1;
                        break;
                     }
                }
                CheckBoard[i-k-3][j+k+3]=0;
            }
        }
    }
    return out;
}